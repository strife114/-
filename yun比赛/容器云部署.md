# 赛题1

## 基础环境搭建

1. 所有节点修改主机名并配置映射

   ```
   hostnamectl set-hostname master
   bash
   hostnamectl set-hostname node
   bash
   
   vim /etc/hosts
   10.18.4.14 master
   10.18.4.25 node
   ```

2. 关闭selinux和防火墙

   ```
   vim /etc/selinux/config
   SELINUX=disabled
   
   
   # systemctl stop firewalld.service
   # systemctl disable firewalld.service
   # yum remove -y NetworkManager firewalld
   # 清空防火墙规则
   yum install -y iptables-services
   iptables -F
   iptables -X
   iptables -Z
   service iptables save
   ```

3. 配置yum源

   master

   ```
   mount -o loop chinaskill_cloud_pass.iso /mnt/
   cp -rfv /mnt/* /opt/
   umount /mnt/
   
   rm -rf /etc/yum.repos.d/*
   vim /etc/yum.repos.d/local.repo
   [k8s]
   name=k8s
   baseurl=file:///opt/kubernetes-repo
   gpgcheck=0
   enabled=1
   
   # yum install -y vsftpd
   # vi /etc/vsftpd/vsftpd.conf 
   anon_root=/opt
   # systemctl start vsftpd && systemctl enable vsftpd
   ```

   node

   ```
   rm -rf /etc/yum.repos.d/*
   vim /etc/yum.repos.d/local.repo
   [k8s]
   name=k8s
   baseurl=ftp://master/kubernetes-repo
   gpgcheck=0
   enabled=1
   ```

   

## 部署Harbor仓库

1. 执行脚本

   ```
   cd /opt
   ./k8s_harbor_install.sh
   ```

2. 上传镜像

   ```
    cd /opt/
    ./k8s_image_push.sh
    输入镜像仓库地址(不加http/https): 10.18.4.10
   输入镜像仓库用户名: admin
   输入镜像仓库用户密码: Harbor12345
   您设置的仓库地址为: 10.24.2.32,用户名: admin,密码: xxx
   是否确认(Y/N): Y
   
   
   
   # 重启docker服务后，仓库不会重启，需要手动重启
   cd /opt/harbor/harbor
   ./prepare
   ./install.sh --with-clair
   ```



## 部署Kubernetes集群

1. 执行脚本

   ```
   cd /opt
   ./k8s_master_install.sh
   ```

2. node节点加入集群

   ```
   scp /opt/k8s_node_install.sh node:/opt/
   
   cd /opt
   ./k8s_node_install.sh
   ```

3. 在master上查看节点信息

   ```
   kubectl get nodes
   ```

   

